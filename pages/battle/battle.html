<html>
  <head>
    <title>Pokemon 101 - Battle!</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="../../styles.css" />
    <link rel="stylesheet" href="./battle.css" />
  </head>

  <body>
    <div class="flex-column container">
      <main class="battle-container">
        <div class="buddy-stats">
          <div class="flex">
            <h1>Turtwig</h1>
            <span>Lv. 5</span>
          </div>
          <div class="health-ui flex">
            <em class="health-label">HP</em>
            <div class="w-100 flex">
              <span class="health-meter" id="allyHealthBar"></span>
            </div>
          </div>
          <div class="flex justify-end"><span>65</span>/<span>65</span></div>
        </div>
        <div class="pokemon-container buddy w-25">
          <img src="https://img.pokemondb.net/sprites/heartgold-soulsilver/back-normal/turtwig.png" alt="Piplup" />
        </div>
        <div class="enemy-stats">
          <div class="flex">
            <h1>Turtwig</h1>
            <span>Lv. 5</span>
          </div>
          <div class="health-ui flex">
            <em class="health-label">HP</em>
            <div class="health-bar w-100 flex">
              <span class="health-meter" id="enemyHealthBar"></span>
            </div>
          </div>
        </div>
        <div class="pokemon-container enemy w-25"><img src="https://img.pokemondb.net/sprites/heartgold-soulsilver/normal/turtwig.png" alt="Turtwig" /></div>
      </main>
      <section id="controls" class="controls-container w-100">
        <button onclick="attack()">Fight</button>
        <button onclick="attack()">Bag</button>
        <button onclick="attack()">Pokemon</button>
        <button onclick="attack()">Run</button>
      </section>
      <section id="dialogue" class="textbox">
        <p id="text"></p>
        <button id="arrowButton" onclick="update()" class="text-arrow">&blacktriangledown;</button>
      </section>
    </div>
  </body>
  <script>
    const maxHealth = 65;
    let allyHealth = maxHealth;
    let allyHealthBar = document.getElementById("allyHealthBar");
    let enemyHealth = maxHealth;
    let enemyHealthBar = document.getElementById("enemyHealthBar");
    let controls = document.getElementById('controls');
    let dialogue = document.getElementById('dialogue');
    let action = 0;
    switchControls(true);

    function attack(attack) {
        action = 0;
        update();
    }

    function update(){
      if(action===0){
        switchControls(false);
        updateTextbox('Turtwig used Tackle!');
      } if(action===1){
        updateTextbox('Enemy Turtwig used Tackle!');
        
        enemyHealth = Math.max(enemyHealth - 10, 0);
        const healthRatio = (enemyHealth / maxHealth) * 100;

        enemyHealthBar.style.width = healthRatio + '%';
        if(healthRatio < 30){
          enemyHealthBar.style.backgroundColor = 'red';
        } else if(healthRatio < 50){
          enemyHealthBar.style.backgroundColor = 'gold';
        }

      } if(action===2){
        switchControls(true);

        allyHealth = Math.max(allyHealth - 10, 0);
        const healthRatio = (allyHealth / maxHealth) * 100;

        allyHealthBar.style.width = healthRatio + '%';
        if(healthRatio < 30){
          allyHealthBar.style.backgroundColor = 'red';
        } else if(healthRatio < 50){
          allyHealthBar.style.backgroundColor = 'gold';
        }
      } 
      action++;
      if(action > 2) action = 0;
    }


    function switchControls(isMyTurn){
      if(!isMyTurn){
        controls.style = "display:none;";
        dialogue.style = "";
      } else {
        dialogue.style = "display:none;";
        controls.style = "";
      }
    }

    function updateTextbox(message){
        let textbox = document.getElementById('text');
        if(textbox){
          textbox.innerHTML = message;
        }
      }
  </script>
</html>
